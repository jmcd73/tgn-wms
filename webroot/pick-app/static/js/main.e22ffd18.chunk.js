(this["webpackJsonppick-app"]=this["webpackJsonppick-app"]||[]).push([[0],{105:function(e,t,s){},109:function(e,t,s){"use strict";s.r(t);s(68);var a=s(0),l=s.n(a),i=s(23),n=s.n(i),c=(s(105),s(47)),o=s(112),r=s(113),h=s(66),p=s(111);class m extends a.Component{constructor(e){super(e),this.state={allPicked:!1,selectMessage:"Select a shipper",shipments:[],shipment:{},message:"",showAlert:!1},this.selectOnChange=this.selectOnChange.bind(this),this.fetchShipperPallets=this.fetchShipperPallets.bind(this),this.handleDismiss=this.handleDismiss.bind(this)}handleDismiss(){this.setState({showAlert:!this.state.showAlert})}togglePicked(e,t,s=!1){console.log("togglePicked");const a=this.props.baseUrl+"Pallets/multiEdit/";let l=JSON.parse(JSON.stringify(this.state.shipment.pallets)),i=[],n={};if(s)i=l.map((e,s)=>(l[s].picked=t,{id:e.id,picked:t})),n={allPicked:t};else{i=l.map((s,a)=>l[a].id===e?(l[a].picked=t,{id:s.id,picked:t}):null).filter(e=>e),n={allPicked:l.every((e,t)=>e.picked)}}let o=Object(c.a)({},this.state,{shipment:Object(c.a)({},this.state.shipment,{pallets:[...l]})},n);this.setState(o),fetch(a,{method:"POST",mode:"cors",credentials:"include",headers:{"X-CSRF-Token":window.csrfToken,Accept:"application/json","Content-Type":"application/json","X-Requested-With":"XMLHttpRequest"},body:JSON.stringify(i)}).then(e=>{if(e.ok)return e.json();throw new Error("Failed to POST to "+a+": "+e.status+" "+e.statusText)}).then(e=>{this.setState({message:e.message,messageResult:e.result,showAlert:!0},()=>{setTimeout(()=>{this.setState({showAlert:!1})},3e3)})}).catch(e=>{this.setState({message:e.message||"error updating picked status",messageResult:"danger",showAlert:!0})})}fetchShipperPallets(e){const t=this.props.baseUrl+"Shipments/view/";fetch(t+e,{method:"GET",mode:"cors",crendentials:"include",headers:{Accept:"application/json"}}).then(e=>{if(e.ok)return e.json();throw new Error("failed to request "+t)}).then(e=>{this.setState({shipment:e});const t=e.pallets.every(e=>e.picked);this.setState({allPicked:t})}).catch(e=>{})}selectOnChange(e){0!==parseInt(e.target.value)?this.fetchShipperPallets(e.target.value):this.setState({shipment:{}})}componentDidMount(){const e=this.props.baseUrl+"Shipments/openShipments";fetch(e,{method:"GET",mode:"cors",crendentials:"include",headers:{Accept:"application/json"}}).then(t=>{if(t.ok)return t.json();throw new Error("failed to request "+e+" "+t.status+" "+t.statusText)}).then(e=>{0===e.shipments.length?this.setState({selectMessage:"Reload the page to check for new shippers"}):this.setState(e)}).catch(e=>{console.log(e),this.setState({message:e.message,messageResult:"danger",showAlert:!0})})}render(){const e=this.state,t=e.shipments;let s=e.shipment.pallets,a=0,i=0;let n="label-warning",c=!1;return s&&(s.sort((function(e,t){return e.location.location<t.location.location?-1:e.location.location>t.location.location?1:0})),a=s.length,i=s.filter(e=>!0===e.picked).length,a===i&&(c=!0,n="label-success")),l.a.createElement("div",{className:"col"},l.a.createElement("div",{className:"row"},l.a.createElement("div",{className:"col"},l.a.createElement(p.a.Group,{controlId:"formControlsSelect"},l.a.createElement(p.a.Label,null,"Select a shipper"),l.a.createElement(p.a.Control,{onChange:this.selectOnChange,as:"select",placeholder:"select"},l.a.createElement("option",{key:1,value:0},this.state.selectMessage),t.map((e,t)=>l.a.createElement("option",{key:e.id,value:e.id},e.shipper," ",e.destination)))))),l.a.createElement("div",{className:"row"},l.a.createElement("div",{className:"col-lg-12 col-md-12 col-sm-12"},this.state.showAlert&&l.a.createElement(o.a,{onClose:this.handleDismiss,variant:this.state.messageResult},this.state.message))),l.a.createElement("div",{className:"row"},l.a.createElement("div",{className:"col-lg-12 col-md-12 col-sm-12"},s&&l.a.createElement(r.a,{as:"ul"},l.a.createElement(h.a,{key:0,as:"li",active:!0},l.a.createElement("h3",{className:"list-group-item-heading"},t.shipper,l.a.createElement("span",{style:{float:"right"},className:"label ".concat(n)},i,"/",a)),l.a.createElement("p",{className:"list-group-item-text"},t.destination),l.a.createElement(p.a.Check,null,l.a.createElement(p.a.Check.Label,null,l.a.createElement(p.a.Check.Input,{onChange:e=>this.togglePicked(null,!this.state.allPicked,!0),checked:this.state.allPicked}),"Mark all as picked"))),s.map((e,t)=>{const s=e.picked;let a="list-group-item";return s&&!c&&(a+=" list-group-item-info"),c&&(a+=" list-group-item-success"),l.a.createElement(h.a,{as:"li",className:a,key:e.id},l.a.createElement("h4",{className:"list-group-item-heading"},e.location.location),l.a.createElement("p",{className:"list-group-item-text"},e.pl_ref),l.a.createElement("p",{className:"list-group-item-text"}," ",e.item," ",e.description),l.a.createElement(p.a.Check,null,l.a.createElement(p.a.Check.Label,null,l.a.createElement(p.a.Check.Input,{checked:s,onChange:t=>{this.togglePicked(e.id,t.target.checked)}}),"Picked")))})))))}}var d=m;const u=document.getElementById("root"),g=u.getAttribute("data-baseurl");n.a.render(l.a.createElement(d,{baseUrl:g}),u)},67:function(e,t,s){e.exports=s(109)}},[[67,1,2]]]);
//# sourceMappingURL=main.e22ffd18.chunk.js.map