(this["webpackJsonpshipment-app"]=this["webpackJsonpshipment-app"]||[]).push([[0],{100:function(e,t,a){},110:function(e,t,a){},112:function(e,t,a){},140:function(e,t,a){"use strict";a.r(t);var n=a(0),r=a.n(n),i=a(13),o=a.n(i),c=a(25),l=a(16),s=a(20),d=a(9),u="ADD_ALL_PALLETS",p="ADD_OPERATION_NAME",h="ADD_OPERATION",m="ADD_PRODUCT_TYPE_ID",b="HIDE_ALERT",f="LOAD_OPTIONS",E="SET_IS_EXPANDED",g="SET_LABEL_IDS",y="SET_LABEL_LIST",T="SET_LOADING",O="SET_PRODUCT_DESCRIPTIONS",v="SET_PRODUCT_TYPE_NAME",S="SET_PRODUCTS",_="SET_TYPEAHEAD_LOADING",D="SHOW_ALERT",j="TOGGLE_ALERT",L="UPDATE_BASE_URL",A="SET_SHIPMENT_DETAIL",I="TOGGLE_SHIPPED",C="UPDATE_IS_EXPANDED",k="UPDATE_ITEM_COUNTS",x="UPDATE_PRODUCTS",P="UPDATE_PRODUCT_DESCRIPTIONS",w="UPDATE_CODE_DESCRIPTIONS",R="UPDATE_UI",N="SUBMIT_START",U="UPDATE_ERRORS",V="ADD_SHIPMENT_FROM_FETCH",B={operation:"",id:"",shipment_type:"",shipped:!1,shipper:"",destination:"",product_type_id:"",labelIds:[]};var H={showAlert:!1,alertTextBold:"Default Alert Bold",alertText:"Default alert text",alertVariant:"info"};var M={products:[],productDescriptions:{},labelLists:{},labelCounts:{},productType:0,productTypeName:"",allPallets:[],productTypes:[]};var F={isExpanded:{},options:[],redirect:!1,loading:!1,errors:{},operationName:"",isTypeAheadLoading:!1,baseUrl:""};var X=Object(c.c)({shipment:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:B,t=arguments.length>1?arguments[1]:void 0;switch(t.type){case h:return Object(d.a)({},e,{operation:t.data});case g:return Object(d.a)({},e,{labelIds:t.data});case V:return Object(d.a)({},e,{},t.data);case A:var a=t.data,n=a.fieldName,r=a.fieldValue;return Object.assign({},e,Object(s.a)({},n,r));case I:return Object(d.a)({},e,{shipped:!e.shipped});default:return e}},alert:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:H,t=arguments.length>1?arguments[1]:void 0;switch(t.type){case D:return Object(d.a)({},e,{showAlert:!0},t.data);case b:return Object(d.a)({},e,{showAlert:!1});default:return e}},products:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:M,t=arguments.length>1?arguments[1]:void 0;switch(t.type){case y:return Object(d.a)({},e,{labelLists:Object(d.a)({},e.labelLists,{},t.data)});case m:return Object(d.a)({},e,{productType:t.data});case S:return Object(d.a)({},e,{products:t.data});case v:return Object(d.a)({},e,{productTypeName:t.data});case O:return Object(d.a)({},e,{productDescriptions:t.data});case P:return Object(d.a)({},e,{products:Object(d.a)({},e.products,{},t.data)});case k:return Object(d.a)({},e,{labelCounts:Object(d.a)({},e.labelCounts,{},t.data)});case u:return Object(d.a)({},e,{allPallets:t.data});default:return e}},ui:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:F,t=arguments.length>1?arguments[1]:void 0;switch(t.type){case E:return Object(d.a)({},e,{isExpanded:t.data});case R:return Object(d.a)({},e,{},t.data);case U:return Object(d.a)({},e,{errors:Object(d.a)({},e.errors,{},t.data)});case C:return Object(d.a)({},e,{isExpanded:Object(d.a)({},e.isExpanded,{},t.data)});case _:return Object(d.a)({},e,{isTypeAheadLoading:t.data});case f:return Object(d.a)({},e,{options:t.data});case L:return Object(d.a)({},e,{baseUrl:t.data});case T:return Object(d.a)({},e,{loading:t.data});case j:return Object(d.a)({},e,{showAlert:!e.showAlert});case D:return Object(d.a)({},e,{showAlert:!0},t.data);case p:return Object(d.a)({},e,{operationName:t.data});default:return e}}}),q=a(71),G=(a(100),a(72)),W=a(73),Y=a(88),J=a(89),K=a(15),z=a(30),Q=a(74),Z=a.n(Q),$=function(e){var t=e.loading;return t?r.a.createElement(z.a,null,r.a.createElement(K.a,{lg:12},r.a.createElement("div",{className:"text-center"},r.a.createElement(Z.a,{loading:t,size:14,color:"#ddd"})))):r.a.createElement(r.a.Fragment,null)},ee=a(19),te=function(e){return r.a.createElement(r.a.Fragment,null,e.children)},ae=a(87),ne=(a(110),a(147)),re=function(e){var t=e.variant,a=e.strongText,n=e.normalText,i=e.onDismiss;return r.a.createElement(ne.a,{in:e.show,timeout:300,classNames:"toggen",unmountOnExit:!0},r.a.createElement(ae.a,{variant:t,onClose:i,dismissible:!0},r.a.createElement("strong",null,a," ")," ",n))},ie=(a(111),a(112),a(27)),oe=a(49);function ce(e){var t=e.selectedCount,a=e.children;return r.a.createElement(ie.a,null,r.a.createElement(ie.a.Header,{as:"h5"},"Currently On Shipment ",r.a.createElement(oe.a,{variant:"primary"},t)),r.a.createElement(ie.a.Body,null,a))}var le=a(22),se=a(77),de=a(76),ue=a(85),pe=a(52),he=r.a.createElement(r.a.Fragment,null,r.a.createElement("p",null,"This pallet doesn't have enough days product life left before it expires to allow it to ship.")),me=function(e){var t=e.placement;return r.a.createElement(pe.a,Object.assign({},e,{id:"popover-positioned-".concat(t)}),r.a.createElement(pe.a.Title,null,"Low Dated Stock"),r.a.createElement(pe.a.Content,null,he))},be=function(e){var t=e.disabled,a=e.children,n=e.childKey;return t?r.a.createElement(ue.a,{placement:"bottom",trigger:"click",rootClose:!0,overlay:me},r.a.createElement("span",{key:n},a)):a},fe={loadProductsAndDescriptions:function(e){var t=[],a={},n={};e.forEach((function(r){-1===t.indexOf(r.item_id)&&(t.push(r.item_id),a[r.item_id]=r.code_desc,n=Object(d.a)({},n,{},fe.updateSingleItemLabelCount(e,r.item_id)))}));var r=t.reduce((function(e,t,a){return e[t]=!1,e}),{});return{products:t,productDescriptions:a,isExpanded:r,itemCounts:n}},updateCodeDescriptions:function(e){return function(t,a){t({type:w});var n=a().products,r=n.products,i=n.allPallets,o=i.filter((function(t){return parseInt(t.id)===parseInt(e)}))[0],c=o.item_id,l=o.code_desc;t({type:k,data:fe.updateSingleItemLabelCount(i,c)}),-1===r.indexOf(c)&&(t({type:C,data:Object(s.a)({},c,!1)}),t({type:x,data:c}),t({type:P,data:Object(s.a)({},c,l)}))}},updateSingleItemLabelCount:function(e,t){var a=e.filter((function(e,a){return e.item_id===t})).length;return Object(s.a)({},t,a)},createCodeDescriptions:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[],t=0,a={},n=e.reduce((function(e,n){var r=n.code_desc;return-1===e.indexOf(r)&&(e.push(r),t=1),a[r]=t++,e}),[]);return this.setState({labelCounts:Object(d.a)({},this.state.labelCounts,{},a)}),n},getLabelList:function(e,t){var a=t.reduce((function(t,a,n){return a.item_id===e&&t.push(a),t}),[]);return Object(s.a)({},e,a)},toggleIsExpanded:function(e,t){return Object.keys(t).forEach((function(a){parseInt(a)===parseInt(e)?t[a]=!t[a]:t[a]=!1})),t},toggleAlert:function(e,t,a){var n=this,r=!this.state.showAlert;this.setState({alertVariant:a,alertText:e,alertTextBold:t,showAlert:r}),r&&setTimeout((function(){n.setState({showAlert:!r})}),4e3)},toggleShipped:function(){this.setState({shipment:Object(d.a)({},this.state.shipment,{shipped:!this.state.shipment.shipped})})},addRemoveLabel:function(e,t,a){return e&&-1===a.indexOf(t)&&a.push(t),e||(a=a.filter((function(e){return e!==t}))),a},parseRouterArgs:function(e){return{operation:e.operation,productTypeOrId:e.productTypeOrId}},getValidationState:function(e,t){return void 0!==t[e]},formatErrors:function(e,t){var a=[];if(t[e]){var n=t[e];a=Object.keys(n).map((function(e){return n[e]}))}return a.join(", ")},getLabelObject:function(e,t){return t.filter((function(t,a){return t.id===e}))[0]},buildLabelString:function(e){var t=e.location,a=e.item,n=e.bb_date,r=e.pl_ref,i=e.qty,o=e.description;return[t.location,a,new Date(n).toLocaleDateString(),r,i,o].join(", ")}},Ee=fe,ge=Object(l.b)((function(e){return Object(d.a)({},e)}),(function(e){return{addRemoveLabel:function(t,a,n){e({type:g,data:Ee.addRemoveLabel(t,a,n)}),e(Ee.updateCodeDescriptions(a))}}}))((function(e){var t=e.labelLists,a=e.productId,n=e.labelIds,i=e.addRemoveLabel;return t[a].map((function(e,t){var a=null,o=n.indexOf(e.id)>-1,c={};e.disabled&&(a=r.a.createElement(de.a,{icon:se.a}),c={pointerEvents:"none"});var l=Ee.buildLabelString(e);return r.a.createElement(be,{key:e.pl_ref,childKey:e.pl_ref,disabled:e.disabled},r.a.createElement(le.a.Check,{disabled:e.disabled,style:c,key:e.pl_ref,id:e.pl_ref},r.a.createElement(le.a.Check.Input,{checked:o,isInvalid:e.disabled,type:"checkbox",onChange:function(t){return i(t.target.checked,e.id,n)}}),r.a.createElement(le.a.Check.Label,null,a," ",l)))}))})),ye=Object(l.b)((function(e){var t=e.products;return{isExpanded:e.ui.isExpanded,products:t.products,allPallets:t.allPallets,labelLists:t.labelLists,labelCounts:t.labelCounts,productDescriptions:t.productDescriptions}}),(function(e){return{getLabelList:function(t,a){return e({type:y,data:Ee.getLabelList(t,a)})},toggleIsExpanded:function(t,a){e({type:E,data:Ee.toggleIsExpanded(t,a)})}}}))((function(e){var t=e.labelCounts,a=e.products,n=e.labelIds,i=e.getLabelList,o=e.toggleIsExpanded,c=e.isExpanded,l=e.labelLists,s=e.productDescriptions,d=e.allPallets,u=null;return a&&(u=a.map((function(e,a){var u=null;return l[e]&&c[e]&&(u=r.a.createElement(ie.a.Body,{className:c[e]},r.a.createElement(ge,{labelLists:l,labelIds:n,productId:e}))),r.a.createElement("div",{key:"wrap-".concat(a)},r.a.createElement(ie.a.Header,{onClick:function(){i(e,d),o(e,c)},as:"h5",className:"toggen-header",key:"header-{idx}"}," ",s[e]," ",t[e]&&r.a.createElement(oe.a,{variant:"primary"},t[e])),u)}))),r.a.createElement(ie.a,{key:"card-top-level"},u)})),Te=a(78),Oe=function(e){var t=e.click,a=e.showAlert;return r.a.createElement(Te.a,{variant:"primary",size:"sm",className:"my-btn",onClick:function(){t(),a()},type:"submit"},"Submit")},ve=a(26),Se=Object(l.b)((function(e){var t=e.shipment,a=e.products;return{labelIds:t.labelIds,allPallets:a.allPallets}}),(function(e){return{addRemoveLabel:function(t,a,n){e({type:g,data:Ee.addRemoveLabel(t,a,n)}),e(Ee.updateCodeDescriptions(a))}}}))((function(e){var t=e.labelIds,a=e.allPallets,n=e.addRemoveLabel;return t?t.map((function(e){var i=Ee.getLabelObject(e,a);return r.a.createElement(ve.a,{key:i.pl_ref,id:"checkbox-{id}",checked:!0,label:Ee.buildLabelString(i),onChange:function(e){return n(e.target.checked,i.id,t)}})})):null})),_e={fetchData:function(e,t,a){return function(n){n({type:T});var r=[e,t].filter((function(e){return e})),i="".concat(a,"Shipments/")+r.join("/");return fetch(i,{headers:{Accept:"application/json","X-Requested-With":"XMLHttpRequest"}}).then((function(e){return e.json()})).then((function(r){var i=[],o="",c=t;switch(n({type:h,data:e}),e){case"add-shipment":o="Add",i=r.shipment_labels,n({type:p,data:o}),n({type:m,data:c}),n({type:u,data:i});break;case"edit-shipment":o="Edit";var l=r.shipment.pallets;i=l.concat(r.shipment_labels),n({type:p,data:o}),n({type:u,data:i});var s=l.map((function(e){return e.id}));c=r.shipment.product_type_id,n({type:m,data:c}),n({type:V,data:r.shipment}),n({type:g,data:s})}n(_e.fetchProductType(c,a));var d=Ee.loadProductsAndDescriptions(i),b=d.products,f=d.productDescriptions,y=d.isExpanded,v=d.itemCounts;n({type:k,data:v}),n({type:S,data:b}),n({type:O,data:f}),n({type:E,data:y}),n({type:T,data:!1})})).catch((function(e){return console.log(e)}))}},submitData:function(){return function(e,t){e({type:R,data:{errors:{},loading:!0}});var a=t(),n=a.products,r=a.ui,i=a.shipment,o=i.operation,c=i.shipper,l=i.shipped,u=i.id,p=i.destination,h=i.labelIds,m=r.baseUrl,b=n.productType,f={shipper:c,destination:p,shipped:l,product_type_id:b,pallets:h},E="";switch(o){case"add-shipment":E=b;break;case"edit-shipment":E=u,f.id=u;var g=h.map((function(e){return{shipment_id:u,id:e}}));f=Object(d.a)({},f,{pallets:g});break;default:console.log("it broken")}var y=m+"Shipments/"+[o,E].filter((function(e){return e})).join("/"),T={method:"POST",mode:"cors",cache:"no-cache",credentials:"same-origin",headers:{"X-CSRF-Token":window.csrfToken,"Content-Type":"application/json",Accept:"application/json","X-Requested-With":"XMLHttpRequest"},redirect:"error",body:JSON.stringify(f)};return e({type:N}),fetch(y,T).then((function(e){return e.json()})).then((function(t){var a=!0,n=t.error||{};Object.keys(n).length>0&&(n.pallets&&function e(t,a){for(var n in t)a.apply(this,[n,t[n]]),null!==t[n]&&"object"==typeof t[n]&&e(t[n],a)}(n=n.pallets,(function(e,t){"shipped"===e&&(n=Object(s.a)({},e,t))})),Object.keys(n).forEach((function(t){e({type:U,data:Object(s.a)({},t,n[t])})})),a=!1),e({type:R,data:{loading:!1,redirect:a}})}))}},fetchProductType:function(e,t){return function(a){var n="".concat(t,"ProductTypes/view/").concat(e);if(e)return a({type:"FETCH_PRODUCT_START"}),fetch(n,{headers:{Accept:"application/json","X-Requested-With":"XMLHttpRequest"}}).then((function(e){return e.json()})).then((function(e){e.productType&&a({type:v,data:e.productType.name})})).catch((function(e){throw e}))}},getSearchTerm:function(e){return function(t,a){t({type:_,data:!0}),t({type:"START_FETCH_TYPEAHEAD"});var n=a().ui.baseUrl;return fetch("".concat(n,"Shipments/destinationLookup?term=").concat(e),{headers:{Accept:"application/json"}}).then((function(e){return e.json()})).then((function(e){t({type:_,data:!1}),t({type:f,data:e})}))}}},De=_e,je=a(29),Le=Object(l.b)((function(e){var t=e.shipment,a=e.ui;return{shipped:t.shipped,errors:a.errors}}),(function(e){return{toggleShipped:function(){e({type:I})}}}))((function(e){var t=e.toggleShipped,a=e.getValidationState,n=e.shippedError,i=e.shipped,o=e.errors;return r.a.createElement(je.a,null,r.a.createElement(le.a.Check,{id:"shipped"},r.a.createElement(le.a.Check.Input,{type:"checkbox",checked:i,onChange:t,isValid:a("shipped",o)}),r.a.createElement(le.a.Check.Label,null,"Shipped"),r.a.createElement(le.a.Control.Feedback,null,n)))})),Ae=a(41),Ie=a(42),Ce=a(43),ke=a(86),xe=Object(l.b)((function(e){var t=e.ui,a=e.shipment;return{isTypeAheadLoading:t.isTypeAheadLoading,baseUrl:t.baseUrl,errors:t.errors,options:t.options,shipper:a.shipper,destination:a.destination,shipped:a.shipped}}),(function(e){return{setTypeaheadLoadingState:function(t){e({type:_,data:t})},getSearchTerm:function(t){e(De.getSearchTerm(t))},setShipmentDetail:function(t,a){e({type:A,data:{fieldName:t,fieldValue:a}})}}}))((function(e){var t=e.formatErrors,a=e.setShipmentDetail,n=e.isTypeAheadLoading,i=e.getSearchTerm,o=e.errors,c=e.options,l=e.destination,s=e.shipper;return r.a.createElement(le.a.Row,{onSubmit:function(e){return e.preventDefault()}},r.a.createElement(K.a,{lg:3},r.a.createElement(je.a,{controlId:"shipper"},r.a.createElement(Ie.a,null,"Shipment")," ",r.a.createElement(Ae.a,{type:"text",value:s,isValid:Ee.getValidationState("shipper",o),placeholder:"Shipment",onChange:function(e){a(e.target.id,e.target.value)},required:"required"}),r.a.createElement(Ae.a.Feedback,null),r.a.createElement(Ce.a,null,t("shipper",o)))),r.a.createElement(K.a,{lg:3,key:"row-col-2"},r.a.createElement(je.a,{controlId:"destination"},r.a.createElement(Ie.a,null,"Destination"),r.a.createElement(ke.a,{minLength:1,placeholder:"Destination",isLoading:n,id:"destination",isValid:Ee.getValidationState("destination",o),selected:[l],onChange:function(e){if(e.length>0){var t=e[0].value;a("destination",t)}},onInputChange:function(e){a("destination",e)},onSearch:function(e){i(e)},labelKey:"value",options:c}),r.a.createElement(Ce.a,null,t("destination",o)))))})),Pe=function(e,t,a){return{type:D,data:{alertTextBold:e,alertText:t,alertVariant:a}}},we=function(e){Object(J.a)(a,e);var t=Object(Y.a)(a);function a(){return Object(G.a)(this,a),t.apply(this,arguments)}return Object(W.a)(a,[{key:"componentDidMount",value:function(){var e=Ee.parseRouterArgs(this.props.match.params),t=e.operation,a=e.productTypeOrId,n=this.props,r=n.baseUrl,i=n.dispatch,o=n.fetchData;i({type:L,data:r}),o(t,a,r)}},{key:"render",value:function(){var e=this,t=this.props,a=t.products,n=t.productDescriptions,i=t.labelLists,o=t.showAlert,c=t.labelCounts,l=t.isExpanded,s=t.productTypeName,d=t.loading,u=t.baseUrl,p=t.redirect,h=t.operationName,m=t.options,b=t.alertText,f=t.errors,E=t.submitData,g=t.isTypeAheadLoading,y=t.alertTextBold,T=t.alertVariant,O=t.labelIds;return p&&(window.location=u+"Shipments/"),r.a.createElement(te,null,r.a.createElement(z.a,{key:"row-1"},r.a.createElement(K.a,{lg:12},r.a.createElement(re,{strongText:y,normalText:b,variant:T,show:o,onDismiss:this.toggleAlert}),r.a.createElement("h3",null,h," ",s," Shipment"))),r.a.createElement(z.a,{key:"row-2"},r.a.createElement(K.a,{lg:12,key:"row-col-1"},r.a.createElement(xe,{options:m,setState:function(t){return e.setState(t)},getValidationState:Ee.getValidationState,isTypeAheadLoading:g,formatErrors:Ee.formatErrors}))),r.a.createElement(z.a,{key:"row-3"},r.a.createElement(K.a,{lg:6},r.a.createElement(Le,{toggleShipped:this.toggleShipped,getValidationState:Ee.getValidationState,shippedError:Ee.formatErrors("shipped",f)})),r.a.createElement(K.a,{lg:1,className:"mb-3"},r.a.createElement(Oe,{click:E,showAlert:Pe})),r.a.createElement(K.a,{lg:5},r.a.createElement($,{loading:d}))),r.a.createElement(z.a,{key:"row-4"},r.a.createElement(K.a,null,r.a.createElement("div",{className:"pre-scrollable"},r.a.createElement("div",{className:"card-container"},r.a.createElement(ye,{labelLists:i,isExpanded:l,labelCounts:c,products:a,labelIds:O,productDescriptions:n})))),r.a.createElement(K.a,null,r.a.createElement(ce,{selectedCount:O.length},r.a.createElement(Se,{count:O.length})))))}}]),a}(r.a.Component),Re=Object(l.b)((function(e){var t=e.shipment,a=e.ui,n=e.products;return{labelIds:t.labelIds,labelCounts:n.labelCounts,errors:a.errors,products:n.products,productDescriptions:n.productDescriptions,labelLists:n.labelLists,showAlert:a.showAlert,isExpanded:a.isExpanded,productTypeName:n.productTypeName,loading:a.loading,options:a.options,redirect:a.redirect,operationName:a.operationName,isTypeAheadLoading:a.isTypeAheadLoading,alertTextBold:a.alertTextBold,alertText:a.alertText,alertVariant:a.alertVariant}}),(function(e){return{dispatch:e,fetchData:function(t,a,n){e(De.fetchData(t,a,n))},submitData:function(){e(De.submitData())},showAlertFunc:function(){e(Pe("Bold","Text","danger"))}}}))(Object(ee.f)(we)),Ne=a(84),Ue=a(83),Ve=document.getElementById("root"),Be=Ve.getAttribute("data-baseurl"),He=(Object(Ue.createLogger)(),window.__REDUX_DEVTOOLS_EXTENSION_COMPOSE__||c.d),Me=[q.a];var Fe=Object(c.e)(X,He(c.a.apply(void 0,Me)));o.a.render(r.a.createElement(l.a,{store:Fe},r.a.createElement(Ne.a,null,r.a.createElement(ee.c,null,r.a.createElement(ee.a,{path:"/",exact:!0,render:function(e){return r.a.createElement(Re,Object.assign({},e,{baseUrl:Be}))}}),r.a.createElement(ee.a,{path:"/:operation(edit-shipment|add-shipment)/:productTypeOrId?",render:function(e){return r.a.createElement(Re,Object.assign({},e,{baseUrl:Be}))}}),r.a.createElement(ee.a,{path:"".concat(Be,"shipments/process/:operation(edit-shipment|add-shipment)/:productTypeOrId?"),render:function(e){return r.a.createElement(Re,Object.assign({},e,{baseUrl:Be}))}})))),Ve)},91:function(e,t,a){e.exports=a(140)}},[[91,1,2]]]);
//# sourceMappingURL=main.e357d3f6.chunk.js.map