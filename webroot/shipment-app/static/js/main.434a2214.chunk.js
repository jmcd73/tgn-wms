(this["webpackJsonpshipment-app"]=this["webpackJsonpshipment-app"]||[]).push([[0],{150:function(e,t,a){e.exports=a(331)},155:function(e,t,a){},167:function(e,t,a){},169:function(e,t,a){},331:function(e,t,a){"use strict";a.r(t);var n=a(0),r=a.n(n),i=a(7),s=a.n(i),l=(a(155),a(6)),o=a(134),c=a(135),d=a(42),p=a(146),u=a(147),h=a(10),m=a(32),b=a(18),f={fetchData:function(e,t){var a=this;this.setState(Object(l.a)({},this.defaults,{loading:!0}));var n=[e,t].filter((function(e){return e})),r=this.state.baseUrl+"Shipments/"+n.join("/");fetch(r,{headers:{Accept:"application/json","X-Requested-With":"XMLHttpRequest"}}).then((function(e){return e.json()})).then((function(n){var r=[],i="",s=t;switch(e){case"add-shipment":i="Add",r=n.shipment_labels,a.setState({operationName:i,productType:s,allPallets:r,shipment:Object(l.a)({},a.state.shipment,{operation:e})});break;case"edit-shipment":i="Edit";var o=n.shipment.pallets;r=o.concat(n.shipment_labels),a.setState({operationName:i,allPallets:r});var c=o.map((function(e){return e.id}));s=n.shipment.product_type_id,a.setState({productType:s,shipment:Object(l.a)({},a.state.shipment,{},n.shipment,{operation:e,labelIds:c})})}a.fetchProductType(s),a.loadProductsAndDescriptions(r),a.setState({loading:!1})})).catch((function(e){return console.log(e)}))},submitData:function(){var e=this;this.setState({errors:{},loading:!0});var t=this.state,a=t.baseUrl,n=t.productType,r=this.state.shipment,i=r.operation,s=r.shipper,o=r.shipped,c=r.id,d=r.destination,p=r.labelIds,u={shipper:s,destination:d,shipped:o,product_type_id:n,pallets:p},h="";switch(i){case"add-shipment":h=n;break;case"edit-shipment":h=c,u.id=c;var m=p.map((function(e){return{shipment_id:c,id:e}}));u=Object(l.a)({},u,{pallets:m});break;default:console.log("it broken")}var f=a+"Shipments/"+[i,h].filter((function(e){return e})).join("/"),g={method:"POST",mode:"cors",cache:"no-cache",credentials:"same-origin",headers:{"X-CSRF-Token":window.csrfToken,"Content-Type":"application/json",Accept:"application/json","X-Requested-With":"XMLHttpRequest"},redirect:"error",body:JSON.stringify(u)};fetch(f,g).then((function(e){return e.json()})).then((function(t){var a=!0,n=t.error||{};Object.keys(n).length>0&&(n.pallets&&function e(t,a){for(var n in t)a.apply(this,[n,t[n]]),null!==t[n]&&"object"==typeof t[n]&&e(t[n],a)}(n=n.pallets,(function(e,t){"shipped"===e&&(n=Object(b.a)({},e,t))})),Object.keys(n).forEach((function(t){e.setState({errors:Object(l.a)({},e.state.errors,Object(b.a)({},t,n[t]))})})),a=!1),e.setState({loading:!1,redirect:a})}))},fetchProductType:function(e){var t=this,a=this.state.baseUrl+"ProductTypes/view/".concat(e);e&&fetch(a,{headers:{Accept:"application/json","X-Requested-With":"XMLHttpRequest"}}).then((function(e){return e.json()})).then((function(e){console.log("ProductType",e),e.productType&&t.setState({productTypeName:e.productType.name}),console.log("pt",e)})).catch((function(e){throw e}))},getSearchTerm:function(e){var t=this;fetch("".concat(this.state.baseUrl,"Shipments/destinationLookup?term=").concat(e),{headers:{Accept:"application/json"}}).then((function(e){return e.json()})).then((function(e){console.log(e),t.setState({isTypeAheadLoading:!1,options:e})}))}},g=a(136),E=a.n(g),v=function(e){var t=e.loading;return t?r.a.createElement(m.a,null,r.a.createElement(h.a,{lg:12},r.a.createElement("div",{className:"text-center"},r.a.createElement(E.a,{loading:t,size:14,color:"#ddd"})))):r.a.createElement(r.a.Fragment,null)},y=a(13),S=function(e){return r.a.createElement(r.a.Fragment,null,e.children)},j=a(145),O=(a(167),a(337)),k=function(e){var t=e.variant,a=e.strongText,n=e.normalText,i=e.onDismiss;return r.a.createElement(O.a,{in:e.show,timeout:300,classNames:"toggen",unmountOnExit:!0},r.a.createElement(j.a,{variant:t,onClose:i,dismissible:!0},r.a.createElement("strong",null,a," ")," ",n))},w=(a(168),a(169),a(24)),L=a(61);function T(e){var t=e.selectedCount,a=e.children;return r.a.createElement(w.a,null,r.a.createElement(w.a.Header,{as:"h5"},"Currently On Shipment ",r.a.createElement(L.a,{variant:"primary"},t)),r.a.createElement(w.a.Body,null,a))}var I=a(19),x=a(139),C=a(138),D=a(144),A=a(63),_=r.a.createElement(r.a.Fragment,null,r.a.createElement("p",null,"This pallet doesn't have enough days product life left before it expires to allow it to ship.")),P=function(e){var t=e.placement;return r.a.createElement(A.a,Object.assign({},e,{id:"popover-positioned-".concat(t)}),r.a.createElement(A.a.Title,null,"Low Dated Stock"),r.a.createElement(A.a.Content,null,_))},R=function(e){var t=e.disabled,a=e.children,n=e.childKey;return t?r.a.createElement(D.a,{placement:"bottom",trigger:"click",rootClose:!0,overlay:P},r.a.createElement("span",{key:n},a)):a};function N(e){var t=e.labelCounts,a=e.newProducts,n=e.labelIds,i=e.getLabelList,s=e.toggleIsExpanded,l=e.newIsExpanded,o=e.labelLists,c=e.addRemoveLabel,d=e.newProductDescriptions,p=e.buildLabelString,u=["FormCheck","fixed","pallet-list"],h=null;return a&&(h=a.map((function(e,a){return r.a.createElement("div",{key:"wrap-".concat(a)},r.a.createElement(w.a.Header,{onClick:function(){i(e),s(e,a)},as:"h5",className:"toggen-header",key:"header-{idx}"}," ",d[e]," ",t[e]&&r.a.createElement(L.a,{variant:"primary"},t[e])),o[e]&&l[e]&&r.a.createElement(w.a.Body,{className:l[e]},o[e].map((function(e,t){var a=null,i=u.slice(),s=n.indexOf(e.id)>-1,l={};e.disabled&&(i.push("bg-danger"),a=r.a.createElement(r.a.Fragment,null,r.a.createElement(C.a,{icon:x.a})," "),l={pointerEvents:"none"});var o=p(e);return r.a.createElement(R,{key:e.pl_ref,childKey:e.pl_ref,disabled:e.disabled},r.a.createElement(I.a.Check,{disabled:e.disabled,style:l,key:e.pl_ref,id:e.pl_ref},r.a.createElement(I.a.Check.Input,{checked:s,isInvalid:e.disabled,type:"checkbox",onChange:function(t){return c(t.target.checked,e.id)}}),r.a.createElement(I.a.Check.Label,null,a," ",o)))}))))}))),r.a.createElement(w.a,{key:"card-top-level"},h)}var U=a(140),V=function(e){var t=e.click;return r.a.createElement(U.a,{variant:"primary",size:"sm",className:"my-btn",onClick:t,type:"submit"},"Submit")},q=a(23),F=function(e){var t=e.labelIds,a=e.getLabelObject,n=e.buildLabelString,i=e.addRemoveLabel;if(t)return t.map((function(e,t){var s=a(e);return r.a.createElement(q.a,{key:s.pl_ref,id:"checkbox-{id}",checked:!0,label:n(s),onChange:function(e){return i(e.target.checked,s.id)}})}))},B={isExpanded:{},newIsExpanded:{},products:[],productDescriptions:{},shipmentTypeDisabled:!1,labelLists:{},loading:!1,redirect:!1,labelCounts:{},showAlert:!1,errors:{},operationName:"",shipment:{operation:"",id:"",shipment_type:"",shipped:!1,shipper:"",destination:"",product_type_id:"",labelIds:[]},isTypeAheadLoading:!1,productType:0,productTypeName:"",allPallets:[],options:[],productTypes:[],baseUrl:"",alertTextBold:"Default Alert Bold",alertText:"Default alert text",alertVariant:"info"},X=a(89),H={setShipmentDetail:function(e,t){this.setState({shipment:Object(l.a)({},this.state.shipment,Object(b.a)({},e,t))})},loadProductsAndDescriptions:function(e){var t=this,a=[],n={};e.forEach((function(r){-1===a.indexOf(r.item_id)&&(a.push(r.item_id),n[r.item_id]=r.code_desc,t.updateSingleItemLabelCount(e,r.item_id))}));var r=a.reduce((function(e,t,a){return e[t]=!1,e}),{});this.setState({newProducts:a,newProductDescriptions:n,newIsExpanded:r})},updateCodeDescriptions:function(e){var t=this.state,a=t.newProducts,n=t.newProductDescriptions,r=t.allPallets,i=t.newIsExpanded,s=r.filter((function(t){return parseInt(t.id)===parseInt(e)}))[0].item_id;this.updateSingleItemLabelCount(r,s),-1===a.indexOf(s)&&this.setState({newIsExpanded:Object(l.a)({},i,Object(b.a)({},s,!1)),newProducts:[].concat(Object(X.a)(a),[s]),newProductDescriptions:Object(l.a)({},n,Object(b.a)({},s,"A new description "+s))})},updateSingleItemLabelCount:function(e,t){var a=e.filter((function(e,a){return e.item_id===t})).length,n=Object(l.a)({},this.state.labelCounts);this.setState({labelCounts:Object(l.a)({},n,Object(b.a)({},t,a))})},createCodeDescriptions:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[],t=0,a={},n=e.reduce((function(e,n){var r=n.code_desc;return-1===e.indexOf(r)&&(e.push(r),t=1),a[r]=t++,e}),[]);return this.setState({labelCounts:Object(l.a)({},this.state.labelCounts,{},a)}),n},getLabelList:function(e){var t=this.state.allPallets.reduce((function(t,a,n){return a.item_id===e&&t.push(a),t}),[]),a=this.state.labelLists,n=Object(l.a)({},a,Object(b.a)({},e,t));this.setState({labelLists:n})},toggleIsExpanded:function(e,t){var a=Object(l.a)({},this.state.newIsExpanded);Object.keys(a).forEach((function(t){parseInt(t)===parseInt(e)?a[t]=!a[t]:a[t]=!1})),this.setState({newIsExpanded:a})},toggleAlert:function(e,t,a){var n=this,r=!this.state.showAlert;this.setState({alertVariant:a,alertText:e,alertTextBold:t,showAlert:r}),r&&setTimeout((function(){n.setState({showAlert:!r})}),4e3)},toggleShipped:function(){this.setState({shipment:Object(l.a)({},this.state.shipment,{shipped:!this.state.shipment.shipped})})},addRemoveLabel:function(e,t){var a=this.state.shipment,n=Object(X.a)(a.labelIds);console.log(t,e),this.updateCodeDescriptions(t),e&&-1===n.indexOf(t)&&n.push(t),e||(n=n.filter((function(e){return e!==t}))),this.setState({shipment:Object(l.a)({},a,{labelIds:n})})},parseRouterArgs:function(){var e=this.props.match.params;return{operation:e.operation,productTypeOrId:e.productTypeOrId}},getValidationState:function(e){return void 0!==this.state.errors[e]},formatErrors:function(e){var t=[];if(this.state.errors[e]){var a=this.state.errors[e];t=Object.keys(a).map((function(e){return a[e]}))}return t.join(", ")},getLabelObject:function(e){return this.state.allPallets.filter((function(t,a){return t.id===e}))[0]},buildLabelString:function(e){var t=e.location,a=e.item,n=e.bb_date,r=e.pl_ref,i=e.qty,s=e.description;return[t.location,a,new Date(n).toLocaleDateString(),r,i,s].join(", ")}},M=a(31),J=function(e){var t=e.shipped,a=e.toggleShipped,n=e.getValidationState,i=e.shippedError;return r.a.createElement(M.a,null,r.a.createElement(I.a.Check,{id:"shipped"},r.a.createElement(I.a.Check.Input,{type:"checkbox",checked:t,onChange:a,isValid:n("shipped")}),r.a.createElement(I.a.Check.Label,null,"Shipped"),r.a.createElement(I.a.Control.Feedback,null,i)))},K=a(148),W=a(44),z=a(45),G=a(46),Q=a(141),Y=function(e){var t=e.shipperError,a=e.shipper,n=e.getValidationState,i=e.setShipmentDetail,s=e.destinationError,o=e.isTypeAheadLoading,c=e.getSearchTerm,d=e.errors,p=e.shipment,u=e.setState,m=e.options,b=p.destination;return r.a.createElement(I.a.Row,{onSubmit:function(e){return e.preventDefault()}},r.a.createElement(h.a,{lg:3},r.a.createElement(M.a,{controlId:"shipper"},r.a.createElement(z.a,null,"Shipment")," ",r.a.createElement(W.a,{type:"text",value:a,isValid:n("shipper"),placeholder:"Shipment",onChange:function(e){d.shipper;var t=Object(K.a)(d,["shipper"]);u({errors:Object(l.a)({},t)}),i(e.target.id,e.target.value)},required:"required"}),r.a.createElement(W.a.Feedback,null),r.a.createElement(G.a,null,t))),r.a.createElement(h.a,{lg:3,key:"row-col-2"},r.a.createElement(M.a,{controlId:"destination"},r.a.createElement(z.a,null,"Destination"),r.a.createElement(Q.AsyncTypeahead,{placeholder:"Destination",isLoading:o,id:"destination",name:"destination",isValid:n("destination"),selected:[b],onChange:function(e){if(e.length>0){var t=e[0].value;i("destination",t)}},onInputChange:function(e){i("destination",e)},onSearch:function(e){u({isTypeAheadLoading:!0}),c(e)},labelKey:"value",options:m}),r.a.createElement(G.a,null,s))))},Z=function(e){Object(u.a)(a,e);var t=Object(p.a)(a);function a(e){var n;return Object(o.a)(this,a),(n=t.call(this,e)).state=Object(l.a)({},B,{baseUrl:n.props.baseUrl}),Object.keys(H).forEach((function(e){n[e]=H[e].bind(Object(d.a)(n))})),Object.keys(f).forEach((function(e){n[e]=f[e].bind(Object(d.a)(n))})),n}return Object(c.a)(a,[{key:"componentDidMount",value:function(){var e=this.parseRouterArgs(),t=e.operation,a=e.productTypeOrId;this.setState({baseUrl:this.props.baseUrl}),this.fetchData(t,a)}},{key:"render",value:function(){var e=this,t=this.state,a=t.newProducts,n=t.newProductDescriptions,i=t.labelLists,s=t.showAlert,l=t.labelCounts,o=t.newIsExpanded,c=t.shipment,d=t.productTypeName,p=t.loading,u=t.baseUrl,b=t.redirect,f=t.operationName,g=t.options,E=t.alertText,y=t.errors,j=t.isTypeAheadLoading,O=t.alertTextBold,w=t.alertVariant,L=this.formatErrors("shipper"),I=this.formatErrors("shipped"),x=this.formatErrors("destination"),C=c.labelIds,D=c.shipper,A=c.shipped,_=C.length;return b&&(window.location=u+"Shipments/"),r.a.createElement(S,null,r.a.createElement(m.a,{key:"row-1"},r.a.createElement(h.a,{lg:12},r.a.createElement(k,{strongText:O,normalText:E,variant:w,show:s,onDismiss:this.toggleAlert}),r.a.createElement("h3",null,f," ",d," Shipment"))),r.a.createElement(m.a,{key:"row-2"},r.a.createElement(h.a,{lg:12,key:"row-col-1"},r.a.createElement(Y,{shipperError:L,shipper:D,setState:function(t){return e.setState(t)},getSearchTerm:this.getSearchTerm,getValidationState:this.getValidationState,setShipmentDetail:this.setShipmentDetail,destinationError:x,isTypeAheadLoading:j,shipment:c,options:g,errors:y}))),r.a.createElement(m.a,{key:"row-3"},r.a.createElement(h.a,{lg:6},r.a.createElement(J,{shipped:A,toggleShipped:this.toggleShipped,getValidationState:this.getValidationState,shippedError:I})),r.a.createElement(h.a,{lg:1,className:"mb-3"},r.a.createElement(V,{click:this.submitData})),r.a.createElement(h.a,{lg:5},r.a.createElement(v,{loading:p}))),r.a.createElement(m.a,{key:"row-4"},r.a.createElement(h.a,null,r.a.createElement("div",{className:"pre-scrollable"},r.a.createElement("div",{className:"card-container"},r.a.createElement(N,{labelLists:i,newIsExpanded:o,labelCounts:l,newProducts:a,labelIds:C,getLabelList:this.getLabelList,toggleIsExpanded:this.toggleIsExpanded,addRemoveLabel:this.addRemoveLabel,newProductDescriptions:n,buildLabelString:this.buildLabelString})))),r.a.createElement(h.a,null,r.a.createElement(T,{selectedCount:_},r.a.createElement(F,{getLabelObject:this.getLabelObject,buildLabelString:this.buildLabelString,addRemoveLabel:this.addRemoveLabel,labelIds:C})))))}}]),a}(r.a.Component),$=Object(y.f)(Z),ee=a(143),te=document.getElementById("root"),ae=te.getAttribute("data-baseurl");s.a.render(r.a.createElement(ee.a,null,r.a.createElement(y.c,null,r.a.createElement(y.a,{path:"/",exact:!0,render:function(e){return r.a.createElement($,Object.assign({},e,{baseUrl:ae}))}}),r.a.createElement(y.a,{path:"/:operation(edit-shipment|add-shipment)/:productTypeOrId?",render:function(e){return r.a.createElement($,Object.assign({},e,{baseUrl:ae}))}}),r.a.createElement(y.a,{path:"".concat(ae,"shipments/process/:operation(edit-shipment|add-shipment)/:productTypeOrId?"),render:function(e){return r.a.createElement($,Object.assign({},e,{baseUrl:ae}))}}))),te)}},[[150,1,2]]]);
//# sourceMappingURL=main.434a2214.chunk.js.map